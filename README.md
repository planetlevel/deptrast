# Deptrast

[![Java CI with Maven](https://github.com/planetlevel/deptrast/actions/workflows/build.yml/badge.svg)](https://github.com/planetlevel/deptrast/actions/workflows/build.yml)

No more flat dependency lists!

A Java application that constructs a useful *security* dependency tree from a list of components observed at runtime.

![Example Dependency Tree](example.png)
NOTE: the error is expected as the project contains a private test-project.jar which can't be looked up.

## Features

- Reads a flat list of runtime dependencies from a text file
- Fetches complete dependency graphs from the deps.dev REST API
- Reconciles declared versions with actual runtime versions (handles Maven's dependency resolution)
- Identifies minimal set of root dependencies using strict version matching
- Builds accurate dependency trees reflecting actual runtime relationships
- Supports output in standard tree format or Maven dependency:tree format
- Efficient single-pass algorithm with intelligent caching
- Supports multiple package ecosystems (Maven, NPM, etc.)
- Builds a rich SBOM from a flat list

## Example Use

> java -jar target/deptrast-2.0.jar test-data/libraries.txt -

## Security Considerations

Deptrast's goal is to construct a full dependency graph from a flat list of components observed in production. To do this, deptrast uses knowledge of *declared* dependencies to organize the list of libraries provided. The result may not exactly match a dependency tree generated by a build system like maven, but is arguably more accurate since it represents exactly what was observed in production.

## Requirements

- Java 11 or higher
- Maven for building the project

## Project Security

See [SECURITY.md](SECURITY.md) for information about the project's security policy, vulnerability reporting, and best practices. For setup instructions for security scanning, including how to configure the NVD API key for dependency checks, see [SECURITY-SETUP.md](docs/SECURITY-SETUP.md).

## Building the Project

```bash
mvn clean package
```

This will create an executable JAR file as `target/deptrast-2.0.0.jar`.

## Usage

```bash
deptrast <input-file> <output-file> [options]
```

### Required Arguments

- `<input-file>` - Input file path
- `<output-file>` - Output file path (use `"-"` for stdout)

### Input Options

- `--iformat=<format>` - Input format (default: auto)
  - `auto` - Auto-detect from file extension
  - `flat` - Flat list (system:name:version per line)
  - `pom` - Maven pom.xml _(coming soon)_
  - `gradle` - Gradle build file _(coming soon)_
  - `pypi` - Python requirements.txt _(coming soon)_
  - `sbom` - CycloneDX SBOM _(coming soon)_

- `--itype=<type>` - Input type (default: smart)
  - `all` - All dependencies (find roots by analysis)
  - `roots` - Root dependencies (fetch transitive deps from API)
  - `smart` - Auto-detect based on format (pom/gradle/pypiâ†’roots, flat/sbomâ†’all)

### Output Options

- `--oformat=<format>` - Output format (default: tree)
  - `tree` - ASCII tree with unicode characters
  - `maven` - Maven dependency:tree format
  - `sbom` - CycloneDX 1.6 SBOM JSON

- `--project-name=<name>` - Project name for root node (tree/maven output)

### Other Options

- `--verbose`, `-v` - Enable verbose logging

### Input File Format (Flat)

Each line should contain a package in the format: `system:name:version`

- Maven packages: `maven:groupId:artifactId:version`
- NPM packages: `npm:packageName:version`

Example:
```
maven:org.springframework.boot:spring-boot-starter-web:3.1.0
maven:com.google.guava:guava:31.1-jre
npm:react:18.2.0
npm:express:4.18.2
```

Lines starting with `#` are treated as comments and ignored.

### Examples

**Basic usage (tree output to stdout):**
```bash
deptrast libraries.txt -
```

**Generate SBOM:**
```bash
deptrast libraries.txt output.sbom --oformat=sbom
```

**Maven format to file:**
```bash
deptrast libraries.txt deps.txt --oformat=maven --project-name=my-app
```

**Verbose output:**
```bash
deptrast libraries.txt - --verbose
```

This will analyze all packages in the input file, fetch their complete dependency graphs, reconcile versions with actual runtime versions, identify the minimal set of root dependencies, and build an accurate dependency tree. Root dependencies are marked with a red dot (ðŸ”´) for easy identification.

