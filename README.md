# Deptrast

[![Java CI with Maven](https://github.com/planetlevel/deptrast/actions/workflows/build.yml/badge.svg)](https://github.com/planetlevel/deptrast/actions/workflows/build.yml)

No more flat dependency lists!

A Java application that constructs a useful *security* dependency tree from a list of components observed at runtime.

![Example Dependency Tree](example.png)
NOTE: the error is expected as the project contains a private test-project.jar which can't be looked up.

## Features

- Reads a flat list of runtime dependencies from a text file
- Fetches complete dependency graphs from the deps.dev REST API
- Reconciles declared versions with actual runtime versions (handles Maven's dependency resolution)
- Identifies minimal set of root dependencies using strict version matching
- Builds accurate dependency trees reflecting actual runtime relationships
- Supports output in standard tree format or Maven dependency:tree format
- Efficient single-pass algorithm with intelligent caching
- Supports multiple package ecosystems (Maven, NPM, etc.)
- Builds a rich SBOM from a flat list

## Example Use

> java -jar target/deptrast-1.0.jar test-data/libraries.txt

## Security Considerations

Deptrast's goal is to construct a full dependency graph from a flat list of components observed in production. To do this, deptrast uses knowledge of *declared* dependencies to organize the list of libraries provided. The result may not exactly match a dependency tree generated by a build system like maven, but is arguably more accurate since it represents exactly what was observed in production.

## Requirements

- Java 11 or higher
- Maven for building the project

## Project Security

See [SECURITY.md](SECURITY.md) for information about the project's security policy, vulnerability reporting, and best practices. For setup instructions for security scanning, including how to configure the NVD API key for dependency checks, see [SECURITY-SETUP.md](docs/SECURITY-SETUP.md).

## Building the Project

```bash
mvn clean package
```

This will create an executable JAR file as `target/deptrast-1.0.jar`.

## Usage

```bash
java -jar target/deptrast-1.0.jar <input-file> [--maven-format=<project-name>] [--sbom=<output-file>] [--verbose|-v]
```

- `<input-file>`: Path to a file containing all runtime packages (required)
- `[--maven-format=<root-project>]`: Output in Maven dependency:tree format with the specified project name
- `[--detailed-report=<output-file>]`: Generate a detailed report of dependency paths and version conflicts
- `[--sbom=<output-file>]`: Generate CycloneDX 1.6 SBOM JSON file with dependency information
- `[--verbose|-v]`: Enable verbose logging output (disabled by default)

### Input File Format

Each line in the input file should contain a package in the format: `system:name:version`

For Maven packages: `maven:groupId:artifactId:version`
For NPM packages: `npm:packageName:version`

Example:
```
maven:org.springframework.boot:spring-boot-starter-web:3.1.0
maven:com.google.guava:guava:31.1-jre
npm:react:18.2.0
npm:express:4.18.2
```

Lines starting with `#` are treated as comments and ignored.

### Example

```bash
java -jar target/deptrast-1.0.jar libraries.txt
```

This will analyze all packages in `libraries.txt`, fetch their complete dependency graphs, reconcile versions with actual runtime versions, identify the minimal set of root dependencies, and build an accurate dependency tree. Root dependencies will be marked with a red dot (ðŸ”´) for easy identification.

### Maven Dependency:tree Format

To output the dependency tree in Maven's format:

```bash
java -jar target/deptrast-1.0.jar libraries.txt --maven-format=my-project
```

This will generate output compatible with Maven's `dependency:tree` command, using 'my-project' as the root node. The Maven format doesn't include the red dot indicators and follows Maven's standard output format.

